import apnet_pt
import qcelemental as qcel

mol_fsapt = qcel.models.Molecule.from_data("""
-2 1
C   37.460   18.058   28.102
O   36.015   19.027   26.455
C   38.079   19.408   28.419
O   35.097   17.660   27.820
C   38.782   19.654   29.547
O   41.738   17.676   28.572
C   39.229   18.549   30.478
O   41.036   18.268   26.593
C   38.670   17.164   30.079
O   38.869   18.965   31.768
C   37.296   17.298   29.430
O   39.477   16.377   29.196
C   39.657   16.713   27.823
C   38.353   17.214   27.171
C   36.097   18.259   27.412
C   40.903   17.621   27.648
H   39.216   18.380   32.469
H   39.189   20.640   29.738
H   37.878   20.199   27.702
H   40.326   18.479   30.401
H   38.608   16.558   30.990
H   36.865   16.309   29.260
H   36.616   17.842   30.090
H   39.922   15.768   27.341
H   38.613   17.779   26.272
H   37.764   16.339   26.860
--
3 1
C   45.872   23.406   27.290
C   46.870   22.319   26.997
O   47.412   22.228   25.899
C   44.543   22.897   26.739
C   43.286   23.413   27.451
C   43.376   23.217   28.966
N   43.795   21.889   29.418
C   43.152   20.746   29.102
N   42.051   20.698   28.340
N   43.678   19.602   29.541
H   46.183   24.329   26.796
H   45.827   23.606   28.364
H   44.480   23.134   25.671
H   44.517   21.801   26.788
H   43.158   24.489   27.289
H   42.403   22.926   27.030
H   44.100   23.915   29.389
H   42.404   23.468   29.409
H   44.412   21.831   30.215
H   41.380   21.461   28.390
H   41.700   19.779   28.078
H   44.687   19.538   29.685
H   43.170   18.756   29.258
N   47.067   21.478   27.995
C   47.913   20.317   27.866
C   47.356   19.190   28.728
O   46.621   19.467   29.679
H   46.553   21.555   28.861
H   47.963   20.036   26.810
H   48.943   20.529   28.190
N   47.675   17.936   28.429
C   47.277   16.775   29.209
C   48.284   15.661   28.936
O   48.807   15.577   27.822
C   45.920   16.268   28.805
H   48.243   17.723   27.614
H   47.283   17.059   30.265
H   45.568   15.491   29.490
H   45.182   17.072   28.789
H   45.973   15.845   27.805
N   48.629   14.846   29.930
C   49.509   13.692   29.797
H   48.939   12.764   29.676
H   50.140   13.612   30.685
H   48.185   14.981   30.829
H   50.136   13.837   28.917
C   40.044   17.091   38.250
C   38.857   16.379   38.908
O   39.005   15.679   39.917
C   40.737   16.158   37.241
C   39.944   15.852   35.982
C   39.852   17.012   35.010
O   40.871   17.365   34.442
O   38.777   17.564   34.802
H   40.742   17.352   39.050
H   39.729   18.016   37.749
H   41.691   16.620   36.958
H   40.984   15.223   37.763
H   40.442   15.025   35.455
H   38.942   15.496   36.247
N   37.660   16.592   38.375
C   36.498   15.921   38.898
C   35.214   16.594   38.413
C   34.937   16.633   36.952
S   33.640   17.801   36.535
C   32.318   16.722   36.072
H   36.510   14.855   38.621
H   37.608   17.070   37.483
H   36.546   15.958   39.989
H   34.369   16.116   38.927
H   35.235   17.625   38.795
H   35.826   16.929   36.378
H   34.659   15.652   36.568
H   31.414   17.323   35.938
H   32.493   16.190   35.138
H   32.102   15.986   36.854
C   34.135   11.497   35.673
C   34.422   12.407   34.436
C   33.660   12.032   33.174
C   33.952   13.776   34.815
H   34.699   11.855   36.542
H   34.412   10.451   35.491
H   33.066   11.527   35.919
H   35.500   12.413   34.233
H   33.836   12.776   32.390
H   33.952   11.049   32.780
H   32.582   11.998   33.379
H   34.185   14.524   34.053
H   32.866   13.782   34.970
H   34.416   14.102   35.750
C   37.504    9.310   32.549
C   38.872    8.677   32.403
O   39.124    7.519   32.744
H   36.752    8.680   32.064
H   37.444   10.316   32.124
H   37.240    9.368   33.610
N   39.788    9.473   31.907
C   41.134    9.004   31.717
C   41.851   10.022   30.826
C   43.276    9.907   30.326
C   43.756    8.485   30.156
C   43.276   10.586   28.983
H   41.635    8.878   32.687
H   39.550   10.405   31.602
H   41.106    8.014   31.251
H   41.206   10.091   29.935
H   41.755   11.008   31.313
H   43.956   10.434   30.997
H   44.768    8.461   29.734
H   43.781    7.936   31.106
H   43.101    7.929   29.472
H   44.282   10.635   28.547
H   42.633   10.047   28.277
H   42.907   11.612   29.060
C   45.884   11.955   34.014
C   44.713   11.916   33.052
S   44.744   13.322   31.944
H   45.846   11.113   34.716
H   45.888   12.884   34.593
H   46.836   11.893   33.474
H   44.704   10.978   32.496
H   43.759   11.971   33.586
H   45.915   13.011   31.346
C   46.149   18.411   32.720
C   44.648   18.391   32.568
C   44.288   17.100   31.864
C   42.815   16.751   31.803
N   42.628   15.503   32.519
C   41.612   14.686   32.287
N   40.682   14.938   31.372
N   41.494   13.602   33.044
H   46.502   19.297   33.263
H   46.492   17.531   33.278
H   46.639   18.422   31.744
H   44.162   18.423   33.553
H   44.284   19.258   32.004
H   44.699   17.139   30.852
H   44.822   16.279   32.358
H   42.189   17.521   32.274
H   42.483   16.639   30.767
H   43.120   15.420   33.413
H   40.766   15.652   30.647
H   40.014   14.216   31.141
H   42.022   13.569   33.905
H   40.602   13.131   33.089
C   48.372   15.911   24.520
C   47.036   15.570   23.897
C   46.009   16.644   24.270
C   45.273   16.531   25.455
C   45.827   17.768   23.462
C   44.376   17.524   25.840
C   44.931   18.767   23.841
C   44.222   18.635   25.023
O   43.382   19.651   25.405
H   49.147   15.182   24.247
H   48.714   16.898   24.184
H   48.308   15.929   25.612
H   47.124   15.506   22.805
H   46.691   14.589   24.248
H   45.380   15.629   26.046
H   46.386   17.864   22.536
H   43.790   17.436   26.749
H   44.772   19.647   23.228
H   42.641   19.269   25.929
C   41.467   13.422   24.729
C   41.067   14.452   23.671
O   39.967   14.999   23.757
C   42.080   14.163   25.888
C   42.140   13.465   27.235
C   42.847   14.400   28.189
C   40.743   13.090   27.745
H   42.157   12.676   24.322
H   40.553   12.907   25.027
H   43.094   14.483   25.609
H   41.520   15.100   26.030
H   42.727   12.542   27.123
H   42.941   13.971   29.196
H   43.861   14.622   27.837
H   42.319   15.354   28.285
H   40.818   12.540   28.692
H   40.144   13.985   27.945
H   40.191   12.458   27.043
N   41.810   14.141   22.435
C   41.667   15.181   21.427
H   42.768   13.874   22.636
H   40.623   15.500   21.419
H   41.919   14.790   20.437
H   42.295   16.060   21.621
O   35.202   14.794   27.382
H   36.044   14.534   27.776
H   35.131   15.762   27.559
O   43.620   16.043   35.257
H   42.792   16.562   35.130
H   43.482   15.521   36.057
O   38.660   11.495   25.161
H   38.546   12.373   24.772
H   39.266   11.036   24.564
C   34.148   24.860   34.794
C   33.482   24.092   33.666
C   32.871   24.979   32.590
C   33.256   24.505   31.233
C   31.372   24.861   32.590
H   34.552   24.187   35.560
H   34.981   25.464   34.415
H   33.442   25.540   35.288
H   34.232   23.425   33.217
H   32.710   23.427   34.082
H   33.179   26.023   32.737
H   32.823   25.117   30.432
H   34.338   24.508   31.105
H   32.918   23.471   31.079
H   30.912   25.499   31.825
H   31.074   23.827   32.376
H   30.920   25.134   33.555
C   30.414   13.712   32.079
C   31.125   14.978   32.547
O   30.793   15.520   33.602
C   29.417   13.968   30.911
C   28.435   15.036   31.331
C   30.152   14.337   29.635
H   29.872   13.327   32.946
H   31.149   12.957   31.774
H   28.881   13.023   30.749
H   27.661   15.191   30.569
H   27.935   14.774   32.270
H   28.939   15.998   31.484
H   29.448   14.356   28.792
H   30.601   15.334   29.692
H   30.937   13.609   29.392
N   32.145   15.390   31.787
C   32.875   16.634   31.985
C   32.003   17.719   31.346
O   31.694   17.589   30.148
C   34.240   16.627   31.264
C   35.349   15.783   31.904
C   35.997   16.229   33.065
C   35.737   14.577   31.310
C   37.024   15.463   33.605
C   36.765   13.826   31.862
C   37.414   14.264   33.011
H   32.311   14.917   30.912
H   33.018   16.781   33.053
H   34.094   16.346   30.217
H   34.584   17.669   31.238
H   35.720   17.175   33.519
H   35.256   14.260   30.389
H   37.551   15.855   34.464
H   37.059   12.892   31.390
H   38.210   13.674   33.456
N   31.592   18.808   32.029
C   30.743   19.863   31.460
C   31.424   20.591   30.289
O   30.748   21.150   29.427
C   30.441   20.750   32.656
C   30.718   19.906   33.866
C   31.944   19.141   33.409
H   29.843   19.413   31.030
H   31.114   21.617   32.654
H   29.423   21.144   32.611
H   30.896   20.498   34.767
H   29.899   19.207   34.069
H   32.849   19.760   33.449
H   32.126   18.241   33.988
N   32.763   20.590   30.185
C   33.463   21.212   29.077
C   33.045   20.684   27.729
O   33.073   21.405   26.734
C   34.952   21.004   29.191
H   33.314   20.140   30.905
H   33.227   22.281   29.059
H   35.453   21.405   28.308
H   35.361   21.500   30.078
H   35.189   19.937   29.240
N   32.575   19.445   27.669
C   32.087   18.889   26.432
C   30.901   19.696   25.909
O   30.716   19.720   24.690
C   31.731   17.414   26.713
C   31.321   16.545   25.541
C   31.013   15.137   26.058
C   30.543   14.205   24.939
N   30.199   12.899   25.479
H   32.625   18.842   28.485
H   32.877   18.966   25.692
H   32.631   16.988   27.175
H   30.944   17.397   27.478
H   30.441   16.962   25.034
H   32.119   16.493   24.800
H   31.912   14.724   26.537
H   30.236   15.206   26.830
H   29.658   14.606   24.440
H   31.322   14.058   24.186
H   29.449   12.960   26.179
H   29.878   12.243   24.757
H   31.000   12.457   25.948
N   30.100   20.418   26.730
C   28.981   21.215   26.208
C   29.485   22.385   25.377
O   28.828   22.843   24.441
H   28.401   21.571   27.063
H   30.319   20.488   27.723
H   28.340   20.610   25.564
N   30.722   22.823   25.634
C   31.309   23.949   24.922
C   31.396   23.628   23.437
O   31.120   24.467   22.572
C   32.707   24.254   25.517
C   33.299   25.503   24.847
C   32.582   24.507   27.013
H   31.310   22.325   26.294
H   30.664   24.828   25.015
H   33.354   23.388   25.344
H   34.295   25.714   25.251
H   33.387   25.387   23.762
H   32.664   26.376   25.038
H   33.560   24.750   27.442
H   31.920   25.363   27.199
H   32.189   23.652   27.565
N   31.656   22.353   23.159
C   31.761   21.869   21.802
C   32.242   20.403   21.820
C   33.766   20.250   22.033
C   34.219   19.883   23.454
N   33.896   18.494   23.771
C   34.834   17.555   23.931
N   36.131   17.833   23.815
N   34.474   16.305   24.204
H   30.785   21.940   21.301
H   31.580   21.668   23.901
H   32.453   22.503   21.236
H   31.670   19.851   22.575
H   31.980   19.960   20.852
H   34.167   19.487   21.354
H   34.260   21.192   21.761
H   35.294   20.020   23.548
H   33.750   20.522   24.210
H   32.923   18.250   23.891
H   36.445   18.574   24.456
H   36.743   17.027   23.871
H   33.656   15.890   23.782
H   35.169   15.631   24.496
C   38.632   28.146   23.360
C   39.162   27.113   24.367
O   38.527   26.069   24.518
H   37.687   27.763   22.978
H   39.331   28.286   22.528
H   38.472   29.122   23.830
N   40.289   27.317   25.060
C   40.763   26.456   26.133
C   39.756   26.273   27.267
O   39.267   27.278   27.802
C   42.038   27.125   26.611
C   42.417   28.075   25.521
C   41.079   28.559   25.032
H   40.991   25.471   25.707
H   41.827   27.681   27.532
H   42.818   26.397   26.841
H   43.061   28.888   25.867
H   42.944   27.559   24.709
H   40.644   29.303   25.713
H   41.103   28.981   24.025
N   39.423   25.051   27.680
C   38.551   24.807   28.833
C   39.217   23.791   29.752
O   40.012   23.000   29.251
C   37.211   24.133   28.554
C   36.230   24.669   29.560
C   36.636   24.448   27.227
H   39.731   24.247   27.138
H   38.397   25.782   29.298
H   37.313   23.044   28.655
H   35.244   24.235   29.380
H   36.490   24.442   30.599
H   36.134   25.756   29.461
H   35.673   23.942   27.091
H   36.471   25.526   27.109
H   37.287   24.144   26.400
N   38.994   23.745   31.065
C   39.394   22.611   31.867
C   38.505   22.665   33.102
O   37.885   23.692   33.416
C   40.943   22.687   32.147
C   41.446   23.269   33.424
O   41.297   21.311   32.139
H   38.369   24.393   31.534
H   39.238   21.677   31.331
H   41.374   23.208   31.285
H   42.176   21.197   32.525
H   42.542   23.233   33.443
H   41.155   24.318   33.552
H   41.065   22.702   34.281
N   38.365   21.521   33.776
C   37.444   21.422   34.889
C   38.145   21.154   36.206
O   39.301   20.716   36.260
C   36.421   20.306   34.615
S   35.638   20.391   32.993
H   38.899   20.703   33.497
H   36.930   22.387   34.930
H   36.923   19.335   34.713
H   35.615   20.335   35.355
H   36.681   19.897   32.286
N   37.461   21.446   37.291
C   37.998   21.100   38.582
H   39.006   21.506   38.692
H   37.357   21.513   39.363
H   36.516   21.797   37.225
H   38.060   20.012   38.711
O   39.744   23.552   25.011
H   39.261   24.379   24.798
H   39.108   22.832   24.913
O   34.649   13.485   22.683
H   35.070   13.786   21.867
H   35.254   12.828   23.051

units angstrom
no_reorient
symmetry c1
""")

atom_model = apnet_pt.AtomModels.ap2_atom_model.AtomModel(
    ds_root=None,
    ignore_database_null=True,
    use_GPU=False,
).set_pretrained_model(model_id=0)
pair_model = apnet_pt.AtomPairwiseModels.apnet2.APNet2Model(
    atom_model=atom_model.model,
    ignore_database_null=True,
    use_GPU=False,
).set_pretrained_model(model_id=0)
_, pairs = pair_model.predict_qcel_mols(
    [
        mol_fsapt,
    ],
    batch_size=2,
    return_pairs=True,
)
pairs = pairs[0]
fA = {
    "A:203": [ 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25],
}
with open("fB.dat", "r") as f:
    data = f.readlines()
fB = {}
for line in data:
    line = line.strip().split()
    fB[line[0]] = [int(x) - 1 for x in line[1:]]
monA = mol_fsapt.get_fragment(0)
header = """==> AP2-FSAPT <==

   => Full Analysis <=

Frag1     Frag2         Elst     Exch    IndAB    IndBA     Disp    EDisp    Total
"""
print(header)
nA = len(monA.atomic_numbers)
for kA, vA in fA.items():
    for kB, vB in fB.items():
        elst_sum = 0.0
        exch_sum = 0.0
        indu_sum = 0.0
        disp_sum = 0.0
        total_sum = 0.0
        for iA in vA:
            for iB in vB:
                elst_sum += pairs[0, iA, iB - nA]
                exch_sum += pairs[1, iA, iB - nA]
                indu_sum += pairs[2, iA, iB - nA]
                disp_sum += pairs[3, iA, iB - nA]
        total_sum = elst_sum + exch_sum + indu_sum + disp_sum
        # print(
        #     f"{kA} {kB}:\n  TOTAL: {total_sum:.6f}, ELST: {elst_sum:.6f}, EXCH: {exch_sum:.6f}, INDU: {indu_sum:.6f}, DISP: {disp_sum:.6f}"
        # )
        print(
            f"{kA:>7} {kB:>7} {elst_sum:>10.6f} {exch_sum:>10.6f} {indu_sum:>10.6f} {disp_sum:>10.6f} {disp_sum:>10.6f} {total_sum:>10.6f}"
        )
